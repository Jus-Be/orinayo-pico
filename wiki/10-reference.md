# Reference

> **Relevant source files**
> * [looper.c](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c)
> * [main.c](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c)
> * [pico_bluetooth.c](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c)

This page provides quick reference material for developers and users working with the Orinayo system. It includes complete MIDI message specifications, configuration options, button mappings, and troubleshooting guidance. For detailed implementation guides on specific subsystems, see the Architecture section ([#3](./3-architecture.md)), Bluetooth Input System ([#4](./4-bluetooth-input-system.md)), Musical Processing ([#5](./5-musical-processing.md)), and MIDI Output System ([#6](./6-midi-output-system.md)).

## MIDI Message Reference

The Orinayo system implements a dual-output MIDI architecture that simultaneously transmits all messages via USB and UART (31,250 baud). The system generates MIDI messages in three categories: performance notes, control messages, and device-specific SysEx commands.

### Core MIDI Messages

The following table documents all standard MIDI messages generated by the system:

| Message Type | Status Byte | Data Bytes | Function | Code Reference |
| --- | --- | --- | --- | --- |
| Note On | `0x90 + channel` | note, velocity | Play note | [main.c L480-L491](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L480-L491) |
| Note Off | `0x80 + channel` | note, 0 | Stop note | [main.c L480-L491](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L480-L491) |
| Program Change | `0xC0 + channel` | program | Change instrument | [main.c L504-L512](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L504-L512) |
| Control Change | `0xB0 + channel` | controller, value | Modify parameter | [main.c L493-L502](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L493-L502) |
| MIDI Start | `0xFA` | - | Start sequencer | [main.c L514-L522](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L514-L522) |
| MIDI Stop | `0xFC` | - | Stop sequencer | [main.c L514-L522](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L514-L522) |
| MIDI Clock | `0xF8` | - | Timing tick (24 PPQN) | [main.c L520-L521](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L520-L521) |

**Sources:** [main.c L480-L522](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L480-L522)

### Channel Assignment

```

```

**Sources:** [main.c L481-L491](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L481-L491)

 [looper.c L25-L28](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L25-L28)

 [pico_bluetooth.c L1401-L1836](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1401-L1836)

### Output Routing

The system implements simultaneous dual-output through the `midi_n_stream_write` function:

```

```

**Sources:** [main.c L690-L697](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L690-L697)

## Control Change Reference

The system uses Control Change messages for real-time parameter modulation and synthesizer control:

| CC# | Function | Value Range | Target Device | Code Reference |
| --- | --- | --- | --- | --- |
| 0 | Bank Select MSB | 0-127 | SeqTrak/MODX | [pico_bluetooth.c L952-L965](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L952-L965) |
| 3 | Style Control | 1-127 | Generic Arrangers | [pico_bluetooth.c L686-L730](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L686-L730) |
| 7 | Volume | 0-127 | All | [pico_bluetooth.c L1357-L1359](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1357-L1359) |
| 9 | Melody Voice | 1-5 | Generic Arrangers | [pico_bluetooth.c L533-L538](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L533-L538) |
| 14 | Style Select | 1-127 | Generic Arrangers | [pico_bluetooth.c L782-L835](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L782-L835) |
| 15 | Style Group | 1-13 | Generic Arrangers | [pico_bluetooth.c L969](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L969-L969) |
| 27 | Arp Type | 2-15 | SeqTrak | [main.c L459-L466](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L459-L466) |
| 28 | Arp Gate | 0-127 | SeqTrak | [main.c L460-L466](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L460-L466) |
| 29 | Arp Speed | 0-127 | SeqTrak | [main.c L461-L466](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L461-L466) |
| 32 | Bank Select LSB | 0-127 | SeqTrak/MODX | [pico_bluetooth.c L953-L965](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L953-L965) |
| 64 | Hold Pedal | 0-127 | Ample Guitar | [pico_bluetooth.c L476-L522](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L476-L522) |
| 80 | Reverb Type | 0-127 | Dream Synth | [pico_bluetooth.c L1313-L1318](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1313-L1318) |
| 81 | Chorus Type | 0-127 | Dream Synth | [pico_bluetooth.c L1317-L1329](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1317-L1329) |
| 91 | Reverb Depth | 0-127 | Dream Synth | [pico_bluetooth.c L1314-L1326](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1314-L1326) |
| 92 | Scene Select | 0-112 (Ã—16) | MODX | [pico_bluetooth.c L672-L820](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L672-L820) |
| 93 | Chorus Depth | 0-127 | Dream Synth | [pico_bluetooth.c L1318-L1329](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1318-L1329) |

**Sources:** [pico_bluetooth.c L533-L969](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L533-L969)

 [main.c L459-L466](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L459-L466)

## SysEx Command Reference

The system generates manufacturer-specific SysEx messages for deep integration with Yamaha and Ketron devices.

### Yamaha MODX Commands

| Function | SysEx Format | Code Reference |
| --- | --- | --- |
| Set Key | `F0 43 10 7F 1C 0D 00 00 02 00 {key+0x40} F7` | [main.c L231-L249](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L231-L249) |
| Set Tempo | `F0 43 10 7F 1C 0D 06 00 02 1E {tempo_hi} {tempo_lo} F7` | [main.c L333-L352](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L333-L352) |
| Arp On/Off | `F0 43 10 7F 1C 0D 06 00 01 09 {0/1} F7` | [main.c L271-L289](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L271-L289) |
| Arp Octave | `F0 43 10 7F 1C 0D 00 00 02 02 {octave+0x40} F7` | [main.c L251-L269](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L251-L269) |
| Arp Hold | `F0 43 10 7F 1C 0D {part+0x10} 00 06 00 00 {1/2} F7` | [main.c L291-L310](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L291-L310) |

### Yamaha SeqTrak Commands

| Function | SysEx Format | Code Reference |
| --- | --- | --- |
| Set Key | `F0 43 10 7F 1C 0C 30 40 7F {key} F7` | [main.c L393-L410](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L393-L410) |
| Set Tempo | `F0 43 10 7F 1C 0C 30 40 76 {tempo_hi} {tempo_lo} F7` | [main.c L373-L391](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L373-L391) |
| Track Mute | `F0 43 10 7F 1C 0C 30 {track+0x50} 29 {0/0x7D} F7` | [main.c L412-L429](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L412-L429) |
| Pattern Select | `F0 43 10 7F 1C 0C 30 {track+0x50} 0F {pattern} F7` | [main.c L431-L451](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L431-L451) |
| Arp Octave | `F0 43 10 7F 1C 0C 31 {track+0x50} 1C {octave+0x40} F7` | [main.c L354-L371](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L354-L371) |

### Ketron Arranger Commands

| Function | SysEx Format | Code Reference |
| --- | --- | --- |
| Arranger Control | `F0 26 79 05 00 {code} {0/0x7F} F7` | [main.c L552-L566](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L552-L566) |
| Footswitch | `F0 26 7C 05 01 {code+0x55} {0/0x7F} F7` | [main.c L568-L582](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L568-L582) |

### Roland Dream Synth Commands

| Function | SysEx Format | Code Reference |
| --- | --- | --- |
| Delay Rate | `F0 41 00 42 12 40 01 35 {rate} 00 F7` | [main.c L210-L229](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L210-L229) |

**Sources:** [main.c L210-L582](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L210-L582)

## Configuration Flags

The system behavior is controlled through boolean configuration flags that enable different operational modes.

### Mode Configuration

```

```

**Sources:** [pico_bluetooth.c L28-L39](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L28-L39)

### Configuration Variables

| Variable | Type | Default | Description | Toggle Code |
| --- | --- | --- | --- | --- |
| `enable_arranger_mode` | `bool` | `false` | Ketron/Yamaha arranger control | [pico_bluetooth.c L1349-L1360](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1349-L1360) |
| `enable_ample_guitar` | `bool` | `false` | Ample Guitar VST keyswitches | [pico_bluetooth.c L1363-L1369](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1363-L1369) |
| `enable_midi_drums` | `bool` | `false` | Enable looper sequencer | [pico_bluetooth.c L1372-L1377](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1372-L1377) |
| `enable_seqtrak` | `bool` | `false` | Yamaha SeqTrak control | [pico_bluetooth.c L1380-L1388](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1380-L1388) |
| `enable_modx` | `bool` | `false` | Yamaha MODX control | [pico_bluetooth.c L1391-L1398](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1391-L1398) |
| `enable_style_play` | `bool` | `false` | Enable chord generation | [pico_bluetooth.c L30](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L30-L30) |
| `enable_auto_hold` | `bool` | `false` | Sustain notes automatically | [pico_bluetooth.c L31](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L31-L31) |
| `enable_chord_track` | `bool` | `true` | SeqTrak CH10 arp output | [pico_bluetooth.c L35](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L35-L35) |
| `enable_bass_track` | `bool` | `true` | SeqTrak CH8 arp output | [pico_bluetooth.c L36](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L36-L36) |

**Sources:** [pico_bluetooth.c L28-L39](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L28-L39)

 [pico_bluetooth.c L1309-L1399](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1309-L1399)

## Button Mapping Reference

The system maps gamepad buttons to musical functions through the Bluepad32 library. Button states are extracted from the controller data structure and processed in `midi_bluetooth_handle_data`.

### Fret Button Mapping

| Button | Bit | Variable | Musical Function | Code Reference |
| --- | --- | --- | --- | --- |
| Green | but1 | `green` | G chord / Low register | [pico_bluetooth.c L289-L354](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L289-L354) |
| Red | but0 | `red` | Am chord / Bass select | [pico_bluetooth.c L289-L358](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L289-L358) |
| Yellow | but2 | `yellow` | C chord / Normal select | [pico_bluetooth.c L289-L362](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L289-L362) |
| Blue | but3 | `blue` | Dm chord / High select | [pico_bluetooth.c L289-L366](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L289-L366) |
| Orange | but4 | `orange` | F chord / Arpeggio 3 | [pico_bluetooth.c L289-L370](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L289-L370) |

### Control Button Mapping

| Button | Variable | Function | Code Reference |
| --- | --- | --- | --- |
| Pitch/Select | `but6`/`pitch` | Strum pattern selection | [pico_bluetooth.c L372-L542](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L372-L542) |
| Song Key | `but7`/`song_key` | Direct key change (D/E/F/G/A) | [pico_bluetooth.c L546-L560](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L546-L560) |
| Start | `but9`/`start` | Unused (conflicts with axis) | [pico_bluetooth.c L564-L568](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L564-L568) |

### Misc Button Mapping

| Button | Variable | Function | Code Reference |
| --- | --- | --- | --- |
| Logo/Menu Button 0 | `mbut0`/`logo` | Start/Stop sequencer/arranger | [pico_bluetooth.c L601-L739](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L601-L739) |
| Star Power/Button 1 | `mbut1`/`starpower` | Style section select (0-7) | [pico_bluetooth.c L741-L839](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L741-L839) |
| Menu/Button 2 | `mbut2`/`menu` | Registration/style group (0-12) | [pico_bluetooth.c L841-L975](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L841-L975) |
| Config/Button 3 | `mbut3`/`config` | Mode configuration (1-9) | [pico_bluetooth.c L977-L998](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L977-L998) |

### D-Pad Mapping

| Direction | Variable | Function | Code Reference |
| --- | --- | --- | --- |
| Left | `dpad_left`/`left` | Strum down | [pico_bluetooth.c L1247-L1271](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1247-L1271) |
| Right | `dpad_right`/`right` | Strum up | [pico_bluetooth.c L1221-L1245](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1221-L1245) |
| Up | `dpad_up`/`up` | Transpose down | [pico_bluetooth.c L570-L582](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L570-L582) |
| Down | `dpad_down`/`down` | Transpose up | [pico_bluetooth.c L584-L596](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L584-L596) |

### Joystick/Knob Mapping

| Control | Variable | Function | Code Reference |
| --- | --- | --- | --- |
| Joystick Up | `joy_up` | Fill trigger / BPM presets | [pico_bluetooth.c L1000-L1092](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1000-L1092) |
| Joystick Down | `joy_down` | Unused | [pico_bluetooth.c L1094-L1099](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1094-L1099) |
| Knob Up | `knob_up` | Ghost intensity / Recording mode | [pico_bluetooth.c L1101-L1184](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1101-L1184) |
| Knob Down | `knob_down` | Ghost intensity control | [pico_bluetooth.c L1186-L1219](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1186-L1219) |

**Sources:** [pico_bluetooth.c L276-L1274](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L276-L1274)

## Chord Detection System

The system implements a chord detection engine that maps button combinations to MIDI chord voicings.

### Chord Lookup Table Structure

The `chord_chat` table contains guitar fingering patterns indexed by `[root_note][chord_type][string]`:

```

```

**Sources:** [pico_bluetooth.c L138-L151](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L138-L151)

 [pico_bluetooth.c L1401-L1836](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1401-L1836)

### Common Chord Mappings

| Button Combination | Chord | Root Offset | Type | Code Reference |
| --- | --- | --- | --- | --- |
| Yellow | C | +0 | Major | [pico_bluetooth.c L1589-L1595](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1589-L1595) |
| Green | G | -5 | Major | [pico_bluetooth.c L1617-L1623](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1617-L1623) |
| Red | Am | -3 | Minor | [pico_bluetooth.c L1626-L1633](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1626-L1633) |
| Orange | F | -7 | Major | [pico_bluetooth.c L1608-L1614](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1608-L1614) |
| Blue | Dm | +2 | Minor | [pico_bluetooth.c L1598-L1606](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1598-L1606) |
| Green+Red | G/B | +7 (bass -13) | Slash | [pico_bluetooth.c L1530-L1537](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1530-L1537) |
| Yellow+Blue | C/E | +0 (bass -20) | Slash | [pico_bluetooth.c L1520-L1527](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1520-L1527) |
| Red+Yellow | Bb | -2 | Major | [pico_bluetooth.c L1491-L1497](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1491-L1497) |
| Green+Yellow | Gsus | -5 | Sus4 | [pico_bluetooth.c L1500-L1507](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1500-L1507) |

**Sources:** [pico_bluetooth.c L1401-L1633](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1401-L1633)

## Strum Pattern System

The system implements 5 strum patterns with 12 sequence variations each, stored in `strum_pattern[pattern][seq_step][string]`.

### Pattern Types

| Pattern ID | Name | Description | Code Reference |
| --- | --- | --- | --- |
| -1 | No Chord Data | Use pattern arp templates | [main.c L470](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L470-L470) |
| 0 | Full Strum | All 6 strings in sequence | [pico_bluetooth.c L154](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L154-L154) |
| 1 | Strum/Bass | 3-4 strings for melody+bass | [pico_bluetooth.c L155](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L155-L155) |
| 2 | Arpeggio 1 | Single note patterns | [pico_bluetooth.c L156](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L156-L156) |
| 3 | Arpeggio 2 | Alternate single notes | [pico_bluetooth.c L157](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L157-L157) |
| 4 | Arpeggio 3 | Complex picking patterns | [pico_bluetooth.c L158](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L158-L158) |

### Auto-Strum Implementation

When `enable_midi_drums` is active and `active_strum_pattern == 0`, the system generates automatic 16th-note strumming patterns from the `strum_styles` array:

```

```

**Sources:** [pico_bluetooth.c L153-L197](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L153-L197)

 [pico_bluetooth.c L1890-L2006](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1890-L2006)

## Looper Drum Mapping

The looper sequencer uses General MIDI drum mappings on channel 10:

| Track Index | Drum Name | MIDI Note | Variable | Code Reference |
| --- | --- | --- | --- | --- |
| 0 | Bass Drum | 36 | `BASS_DRUM` | [looper.c L31-L52](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L31-L52) |
| 1 | Snare Drum | 38 | `SNARE_DRUM` | [looper.c L32-L53](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L32-L53) |
| 2 | Closed Hi-hat | 42 | `CLOSED_HIHAT` | [looper.c L33-L54](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L33-L54) |
| 3 | Low Floor Tom | 41 | `LOW_FLOOR_TOM` | [looper.c L34-L55](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L34-L55) |
| 4 | Low Tom | 45 | `LOW_TOM` | [looper.c L35-L56](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L35-L56) |
| 5 | Open Hi-hat | 46 | `OPEN_HIHAT` | [looper.c L36-L57](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L36-L57) |
| 6 | Hi Mid Tom | 48 | `HI_MID_TOM` | [looper.c L37-L58](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L37-L58) |
| 7 | Crash Cymbal | 49 | `CRASH_CYMBAL` | [looper.c L38-L59](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L38-L59) |
| 8 | Ride Cymbal | 51 | `RIDE_CYMBAL` | [looper.c L39-L60](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L39-L60) |
| 9 | Vibraslap | 58 | `VIBRASLAP` | [looper.c L40-L61](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L40-L61) |
| 10 | Hi Bongo | 60 | `HI_BONGO` | [looper.c L41-L62](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L41-L62) |
| 11 | Low Bongo | 61 | `LOW_BONGO` | [looper.c L42-L63](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L42-L63) |
| 12 | Mute Conga | 62 | `MUTE_CONGA` | [looper.c L43-L64](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L43-L64) |
| 13 | Low Conga | 64 | `LOW_CONGA` | [looper.c L44-L65](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L44-L65) |

**Sources:** [looper.c L25-L66](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L25-L66)

## Hardware Configuration

### UART Settings

| Parameter | Value | Constant | Code Reference |
| --- | --- | --- | --- |
| UART Interface | uart0 | `UART_ID` | [main.c L58](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L58-L58) |
| Baud Rate | 31250 | `BAUD_RATE` | [main.c L59](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L59-L59) |
| TX Pin | GPIO 0 | `UART_TX_PIN` | [main.c L60](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L60-L60) |
| RX Pin | GPIO 1 | `UART_RX_PIN` | [main.c L61](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L61-L61) |
| Function | GPIO_FUNC_UART=2 | `GPIO_FUNC_UART` | [main.c L62](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L62-L62) |

**Sources:** [main.c L57-L62](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L57-L62)

 [main.c L146-L150](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L146-L150)

### Looper Timing Configuration

| Parameter | Default | Constant | Description | Code Reference |
| --- | --- | --- | --- | --- |
| Default BPM | 120 | `LOOPER_DEFAULT_BPM` | Starting tempo | [looper.c L49](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L49-L49) |
| Total Steps | 32 | `LOOPER_TOTAL_STEPS` | 2-bar pattern length | [looper.c L224](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L224-L224) |
| Steps Per Beat | 4 | `LOOPER_STEPS_PER_BEAT` | 16th note resolution | [looper.c L283](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L283-L283) |
| Click Division | 4 | `LOOPER_CLICK_DIV` | Metronome interval | [looper.c L138](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L138-L138) |

**Sources:** [looper.c L49-L283](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L49-L283)

## Common Troubleshooting

### Bluetooth Connection Issues

```

```

**Common Solutions:**

1. **Device not discovered**: Verify the device name contains "STANDARD GAMEPAD" or is not filtered by COD (Class of Device). Check `pico_bluetooth_on_device_discovered` at [pico_bluetooth.c L220-L243](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L220-L243)
2. **Cannot connect after discovery**: Delete stored pairing keys by calling `uni_bt_del_keys_unsafe()` at initialization [pico_bluetooth.c L210](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L210-L210)
3. **Connection drops frequently**: Ensure `cyw43_arch_init()` completed successfully. The CYW43 chip requires proper initialization for stable Bluetooth operation [main.c L42](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L42-L42)
4. **LED not responding**: Check that `cyw43_arch_gpio_put(CYW43_WL_GPIO_LED_PIN, state)` calls are executing. LED state indicates connection status [pico_bluetooth.c L217-L267](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L217-L267)

**Sources:** [pico_bluetooth.c L200-L274](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L200-L274)

### MIDI Output Problems

```

```

**Common Solutions:**

1. **No USB MIDI output**: Ensure `tusb_init()` was called at startup [main.c L130](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L130-L130)  and `tud_task()` is called in main loop [main.c L153](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L153-L153)
2. **No UART MIDI output**: Verify UART initialization with correct baud rate (31250) and GPIO function settings [main.c L146-L150](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L146-L150)
3. **Notes not playing**: Check that at least one mode flag is enabled (`enable_midi_drums`, `enable_arranger_mode`, etc.). The `looper_perform_ready()` function gates output [looper.c L115-L117](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L115-L117)
4. **UART buffer overflow**: The code waits for UART writable state with `while (!uart_is_writable(UART_ID))` [main.c L694](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L694-L694)  If this hangs, check UART hardware connection.

**Sources:** [main.c L125-L173](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L125-L173)

 [main.c L690-L697](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/main.c#L690-L697)

 [looper.c L115-L117](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L115-L117)

### Timing and Synchronization Issues

```

```

**Common Solutions:**

1. **Clock source switching**: The system auto-detects external MIDI clock and switches from internal to external timing. If timing becomes erratic, check the 250ms timeout in `looper_audit_midi_sync()` [looper.c L437-L454](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L437-L454)
2. **BPM out of range**: Tap tempo detection clamps BPM between 40-240. Invalid values may cause `step_period_ms` calculation errors [looper.c L281-L285](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L281-L285)
3. **Swing timing incorrect**: Ghost note swing modulation uses `swing_ratio` between 0.5-0.65. Values outside this range cause uneven timing [looper.c L148-L158](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L148-L158)
4. **Note scheduler queue full**: The note scheduler has a maximum queue size (24 slots). If notes are dropped, check `note_scheduler_schedule_note()` return value and dispatch frequency [looper.c L131-L134](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L131-L134)

**Sources:** [looper.c L148-L454](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/looper.c#L148-L454)

### Mode Configuration Conflicts

The system implements mutually exclusive modes that should not be enabled simultaneously:

| Mode Flag | Conflicts With | Resolution |
| --- | --- | --- |
| `enable_arranger_mode` | All other modes | Disable other modes when enabling |
| `enable_ample_guitar` | All other modes | Disable other modes when enabling |
| `enable_midi_drums` | All other modes except looper | Disable other modes when enabling |
| `enable_seqtrak` | All other modes | Disable other modes when enabling |
| `enable_modx` | All other modes | Disable other modes when enabling |

**Diagnostic Steps:**

1. Check current mode flags with debug output at [pico_bluetooth.c L28-L39](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L28-L39)
2. Use Config button (mbut3) with fret combinations to toggle modes [pico_bluetooth.c L977-L998](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L977-L998)
3. Verify only one primary mode is `true` at any time
4. Check that `enable_style_play` is set correctly based on active mode [pico_bluetooth.c L1351-L1393](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1351-L1393)

**Sources:** [pico_bluetooth.c L28-L39](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L28-L39)

 [pico_bluetooth.c L977-L998](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L977-L998)

 [pico_bluetooth.c L1309-L1399](https://github.com/Jus-Be/orinayo-pico/blob/122fa496/pico_bluetooth.c#L1309-L1399)